{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <h1 class="page-title">Список дистрибутивов Linux</h1>
            <div class="filter-bar">
                <form method="GET" action="{% url 'distros_list' %}" class="filter-form">
                    <!-- Поиск по названию -->
                    <label>Поиск:
                        <input type="text" name="search" placeholder="Поиск по названию..." value="{{ search_query }}" class="search-input">
                    </label>

                    <!-- Сортировка -->
                    <label>Сортировка:
                        <select name="sort" class="sort-select">
                            <option value="" {% if not sort_option %}selected{% endif %}>По умолчанию</option>
                            <option value="name" {% if sort_option == "name" %}selected{% endif %}>По названию (А-Я)</option>
                            <option value="-name" {% if sort_option == "-name" %}selected{% endif %}>По названию (Я-А)</option>
                        </select>
                    </label>

                    <!-- Фильтрация по тегам -->
                    <label>Фильтрация:
                        <select name="tag" class="filter-select">
                            <option value="">Все теги</option>
                            {% for tag in tags %}
                                <option value="{{ tag.name }}" {% if selected_tag == tag.name %}selected{% endif %}>{{ tag.name }}</option>
                            {% endfor %}
                        </select>
                    </label>

                    <div class="separator"></div>

                    <button type="submit" class="filter-button">Применить</button>
                </form>
            </div>

            <div class="sort-x">
                {% if sort_option %}
                    <p>Сортировка:
                    {% if sort_option == 'name' %}
                         <span class="sort-list" style="margin-left: 2px;">По названию (А-Я)
                            <span>&nbsp;
                                <!-- Ссылка для удаления сортировки -->
                                <a class="h_xmark" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}">
                                    <i class="fa-solid fa-xmark"></i>
                                </a>
                            </span>
                         </span>
                    </p>
                    {% endif %}
                    {% if sort_option == '-name' %}
                        <span class="sort-list" style="margin-left: 2px;">По названию (Я-А)
                            <span>&nbsp;
                                <!-- Ссылка для удаления сортировки -->
                                <a class="h_xmark" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}">
                                    <i class="fa-solid fa-xmark"></i>
                                </a>
                            </span>
                        </span>
                    </p>
                    {% endif %}
                    <br>
                {% endif %}
            </div>

            <div class="filter">
                {% if selected_tag %}
                    <p>Фильтрация:
                        <span class="sort-list">{{ selected_tag }}
                            <span>&nbsp;
                                <!-- Ссылка для удаления фильтрации, сохраняющая сортировку -->
                                <a class="h_xmark" href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if sort_option %}sort={{ sort_option }}&{% endif %}">
                                    <i class="fa-solid fa-xmark"></i>
                                </a>
                            </span>
                        </span>
                    </p>
                {% endif %}
            </div>

        <div class="found">
            <br>
            {% if search_query %}
                {% if count_diff == 1 %}
                    <p>По запросу <strong>{{ search_query }}</strong> найден {{ count }} результат</p>
                {% endif %}
                {% if count_diff == 2 or count_diff == 3 or count_diff == 4 %}
                    <p>По запросу <strong>{{ search_query }}</strong> найдено {{ count }} результата</p>
                {% endif %}
                {% if count_diff > 4 %}
                    <p>По запросу <strong>{{ search_query }}</strong> найдено {{ count }} результатов</p>
                {% endif %}
                {% if count == 0 %}
                    <p>По запросу <strong>{{ search_query }}</strong> ничего не найдено</p>
                {% endif %}
            {% endif %}
        </div>
        {% if selected_tag or sort_option or search_query %}
            <br>
            <div class="clear-filters">
                <a href="{% url 'distros_list' %}" class="clear-filters-button">Сбросить все фильтры</a>
            </div>
        {% endif %}

        <div class="distro-grid">
            {% for distro in distributions %}
                <div class="distro-item">
                    <a href="{% url 'distro_detail' distro.pk %}">
                        <div class="distro-image">
                            <img src="{{ distro.image.url }}" alt="{{ distro.name }}">
                        </div>
                        <div class="distro-info">
                            <h2>{{ distro.name }}</h2>
                            <p style="margin-bottom: 10px;">{{ distro.short_description }}..</p>
                            <div class="tags-distro border-top">
                                {% for tag in distro.tags.all %}
                                    <p>{{ tag.name }}</p>
                                {% endfor %}
                            </div>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}
